<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Productos</title>
</head>
<body>
<h1>Listado de Productos</h1>
<nav>
    <a href="/">Inicio</a> |
    <a href="/clientes">Clientes</a> |
    <a href="/pedidos">Pedidos</a> |
    <a href="/productos">Productos</a>
</nav>
<hr>
<p><a href="/producto/create">➕ Crear Nuevo Producto</a></p>
<table border="1">
    <tr>
        <th>ID Producto</th>
        <th>Descripción</th>
        <th>Pedidos Relacionados</th>
        <th>Acciones</th>
    </tr>
    <?php if (empty($products)): ?>
    <tr>
        <td colspan="4">No hay productos registrados</td>
    </tr>
    <?php else: ?>
    <?php foreach ($products as $product): ?>
    <tr>
        <td><?php echo htmlspecialchars($product->getId()) ?></td>
        <td><?php echo htmlspecialchars($product->getDescription()) ?></td>
        <td>
            <?php
        // Obtener pedidos únicos relacionados con este producto
        $orderIds = [];
        foreach ($product->getDetails() as $detail) {
            $orderId = $detail->getOrder()->getId();
            if (!in_array($orderId, $orderIds)) { ?>
            <a href="/pedido/read/<?php echo $orderId ?>"><?php echo $orderId ?></a>
            <?php
            }
            }
            ?>
        </td>
        <td>
            <a href="/producto/update/<?php echo $product->getId() ?>">Actualizar</a> |
            <a href="/producto/delete/<?php echo $product->getId() ?>">Eliminar</a>
        </td>
    </tr>
    <?php endforeach; ?>
    <?php endif; ?>
</table>
</body>
</html>